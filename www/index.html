<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <title>Hello World</title>
</head>

<body>
    <div class="app2">

    </div>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="http://cdn.socket.io/socket.io-1.0.3.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js"></script>
    <script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript">
        app.initialize();
        var socket = io.connect('http://192.168.2.3:3000');
        /* document.addEventListener('deviceready', function () {
            socket.on('connect', function () {
                socket.on('text', function (text) {
                    alert(text);
                    alert("connected via app");

                });
                socket.on('location', function (data) {
                    alert(data);
                });
            });
        });
        */
         //browser support 
        socket.on('connect', function () {
            socket.on('text', function (text) {
                console.log("connected");
                $(".app2").append("<div class='update'>connected with the server</div>");

            });
            socket.on('location', function (data) {
                console.log("received data");
                $(".app2").html("<div class='update'>" + "Other client coords: " + data + "</div>");
                $(".app2").append("<img src='https://maps.googleapis.com/maps/api/staticmap?center=" + data + "&zoom=13&size=600x300&maptype=roadmap&markers=color:blue%7Clabel:CHILLEN%7C" + data + "'</img>");
                localStorage.setItem("otherLocation", data);
                var rawdata = data;
                var latitude = rawdata.split(" ")[0];
                var longitude = rawdata.split(" ")[1];
                alert("latitude: " + latitude + " longitude: " + longitude);
                



            });
            socket.on('send', function (data) {
                console.log("send data");
                $(".app2").append("<div class='update'>" + data + "</div>");
            });
        });

        function broadcastLocation() {
            var lat = localStorage.getItem("latitude");
            var lon = localStorage.getItem("longitude");
            var latlon = lat + " " + lon;
            socket.send(latlon);
        }
    </script>
    <script type="text/javascript">
        function initialize(latlon) {
            var otherLocation = localStorage.getItem("otherLocation");
            alert(otherLocation);
            var mapCanvas = document.getElementById('map-canvas');
            var mapOptions = {
                center: new google.maps.LatLng(52.654523,5.0474287),
                zoom: 8,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            }
            var map = new google.maps.Map(mapCanvas, mapOptions)
        }
    </script>
    <script type="text/javascript">
        function getLocation() {
            var options = {
                enableHighAccuracy: true
            };
            watchID = navigator.geolocation.watchPosition(onSucces, onError, options);

            function onSucces(position) {
                var lat = position.coords.latitude;
                var lon = position.coords.longitude;

                localStorage.setItem("latitude", lat);
                localStorage.setItem("longitude", lon);

                //alert("latitude: " + lat + "longitude: " + lon);
            }

            function onError() {
                alert("error: " + error.message);
            }

        }
    </script>
    <button id="getLocation" value="Get My Coords" onClick="getLocation()">Get My Coords</button>
    <br />
    <button id="broadcastLocation" value="Broadcast coords" onClick="broadcastLocation()">Broadcast location</button>
    <div id="map-canvas"></div>


</body>

</html>
